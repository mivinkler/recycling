{% extends 'base.html' %}

{% load custom_filters %}
{% load static %}

{% block title %}Wareneingang detail{% endblock %}

{% block content %}
<div class="process-wrapper">
  <div class="process-title">
    <h2>Wareneingang detail</h2>
    <div>Datum: {{ delivery.created_at }}</div>
  </div>

  <table class="process-table">
    <thead>
      <tr class="process-row">
        <th>{{ delivery.customer.name }} - LS: {{ delivery.delivery_receipt }}</th>
        <th>Eingang</th>
        <th>Vorsortierung</th>
        <th>Aufbereitung</th>
        <th>Versand</th>
      </tr>
    </thead>
    <tbody>
      {% for item in delivery_units %}
      <tr class="process-row process-row">
        <td class="indent-1"><span>тоб </span> Liefereinheit: {{ item.get_box_type_display }} - {{ item.material }}</td>
        <td>{{ item.weight }} kg</td>
        <td></td>
        <td></td>
        <td></td>
      </tr>

        {% for unload in item.unload_for_delivery_unit.all %}
        <tr class="process-row process-row-color">
          <td class="indent-2"><span>тоб </span> Vorsortierung: {{ unload.get_box_type_display }} - {{ unload.material }}</td>
          <td></td>
          <td>{{ unload.weight }} kg</td>
          <td></td>
          <td></td>
        </tr>

          {% for recycling in unload.recycling_for_unload.all %}
          <tr class="process-row">
            <td class="indent-3"><span>тоб </span> Aufbereitung: {{ recycling.get_box_type_display }} - {{ recycling.material }}</td>
            <td></td>
            <td></td>
            <td>{{ recycling.weight }} kg</td>
            <td></td>
          </tr>

            {% for shipping in recycling.shipping_for_recycling.all %}
            <tr class="process-row-color">
              <td class="indent-4"><span>тоб </span> Abholung: {{ shipping }}</td>
              <td></td>
              <td></td>
              <td></td>
              <td>{{ shipping.weight }} kg</td>
            </tr>
            {% endfor %}
          {% endfor %}
        {% endfor %}
      {% endfor %}
      <tr class="process-total-weight">
        <td class="total-weight">Gesamt:</td>
        <td class="total-weight">{{ total_item_weight|floatformat:2 }} kg</td>
        <td class="total-weight">
          {{ total_unload_weight|floatformat:2 }} kg
          <p class="process-diff" id="item-diff">
            {{ item_diff|floatformat:2 }} kg
          </p>
        </td>
        <td class="total-weight">
          {{ total_recycling_weight|floatformat:2 }} kg
          <p class="process-diff" id="unload-diff">
            {{ unload_diff|floatformat:2 }} kg
          </p>
        </td>
      </tr>

    </tbody>
  </table>
</div>

<style>      
.process-wrapper {
  margin: 50px auto;
  width: 1000px;
}

.process-title {
  margin-bottom: 50px;
}

.process-table {
  width: 100%;
  border-collapse: collapse;
}

.process-table th,
.process-table td {
  text-align: right;
  border: none;
  line-height: 3;
  padding-right: 8px;
  border-right: 1px solid var(--color-gray-100);
}

.process-table th:last-child,
.process-table td:last-child {
  border-right: none;
}

.process-table th {
  text-align: center;
  padding: 0;
  font-weight: 600;
  background-color: var(--color-gray-50);
}

.process-table th:first-child{
  background-color: #fff;
  font-size: 1.1em;
  padding-left: 5px;
}

.process-row {
  border-bottom: 1px solid var(--color-gray-100) !important;
}

.process-table span {
  font-size: 1.1rem;
  padding-right: 10px;
}

.process-table th:first-child,
.process-table td:first-child {
  text-align: left;
  width: 500px;
}

.process-row-color {
  background-color: var(--color-gray-50);
}

.process-total-weight td:first-child {
   font-size: 1.1em;
}

.process-diff {
  font-size: 0.8em; 
  color: red; 
  line-height: 0.6;
}

.total-weight {
  font-weight: 500;
  vertical-align: top;
  padding-top: 20px;
  padding-right: 8px;
  padding-left: 10px;
}

.indent-1 { padding-left: 20px; font-weight: 500; font-size: 1.1em;}
.indent-2 { padding-left: 60px; font-weight: 500; }
.indent-3 { padding-left: 100px; }
.indent-4 { padding-left: 140px; }
</style>


<script>
document.addEventListener("DOMContentLoaded", function() {
  function updateColorBasedOnValue(elementId) {
    const element = document.getElementById(elementId);
    const value = element.textContent.trim();

    if (value.startsWith("-")) {
      element.style.color = "red";
    } else {
      element.style.color = "green";
    }
  }

  updateColorBasedOnValue("item-diff");
  updateColorBasedOnValue("unload-diff");
});
</script>
{% endblock %}


