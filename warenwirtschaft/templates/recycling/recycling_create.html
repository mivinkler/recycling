{# templates/unload/recycling_create.html #}

{% extends 'base.html' %}
{% load static %}

{% block title %}Aufbereitung{% endblock %}

{% block content %}
<form method="post">
  {% csrf_token %}

  <div class="itemcard">
    <div class="itemcard-title itemcard-margin-left">
      <h2>Aufbereitung</h2>
    </div>

    <section class="itemcard-topbox itemcard-margin-left">
      <div class="itemcard-topbox-row">
        <h3>Liefereinheit: &emsp; {{ unload }}</h3>
      </div>
    </section>

    <section class="itemcard-topbox">
      <h4 class="itemcard-margin-left">Fraktionen:</h4>

      <table class="itemcard-table">
        <thead class="itemcard-thead">
          <tr>
            <th class="checkbox-circle itemcard-action-left"></th>
            <th class="itemcard-id">№</th>
            <th class="itemcard-material">ID</th>
            <th class="itemcard-material">Material</th>
            <th class="itemcard-boxtype">Behälter</th>
            <th class="itemcard-weight">Gewicht</th>
            <th class="itemcard-note">Anmerkung</th>
            <th class="itemcard-action"></th>
          </tr>
        </thead>

        {# ====== Aktive Fraktionen ====== #}
        <tbody class="itemcard-tbody">
          {% for item in all_recyclings %}
            <tr class="itemcard-table-row">
              <td class="checkbox-circle itemcard-action-left">
                <input
                  type="checkbox"
                  name="selected_recycling"
                  value="{{ item.id }}"
                  {% if item.id in active_recycling_ids %}checked{% endif %}
                  disabled
                >
              </td>

              <td class="itemcard-id">{{ forloop.counter }}</td>
              <td class="itemcard-id">{{ item.id }}</td>
              <td class="itemcard-material"><p>{{ item.material }}</p></td>
              <td class="itemcard-boxtype"><p>{{ item.get_box_type_display }}</p></td>
              <td class="itemcard-weight"><p>{{ item.weight }}</p></td>
              <td class="itemcard-note"><p>{{ item.note }}</p></td>
              <td class="itemcard-action-wrapper">
                <div class="itemcard-action">
                  {% if item.id in active_recycling_ids %}
                    <a href="{% url 'recycling_update' unload_pk=unload.pk recycling_pk=item.pk %}" class="btn btn-lock">
                      <img src="{% static 'icons/lock-icon.svg' %}">
                    </a>
                  {% else %}
                    <button
                      type="submit"
                      name="link_recycling"
                      value="{{ item.id }}"
                      class="btn btn-lock"
                      title="Fraktion verknüpfen"
                    >
                      <img src="{% static 'icons/link-hyperlink-icon.svg' %}">
                    </button>
                  {% endif %}
                </div>
              </td>
            </tr>
          {% endfor %}

          {# ====== Neue Fraktion ====== #}
          <tr class="itemcard-table-row">
            <td class="checkbox-circle itemcard-action-left">
              <input type="checkbox" name="selected_recycling" title="Fraktion verknüpfen" disabled>
            </td>
            <td class="itemcard-id">+</td>
            <td class="itemcard-id">+</td>
            <td class="itemcard-material">{{ form.material }}</td>
            <td class="itemcard-boxtype">{{ form.box_type }}</td>
            <td class="itemcard-weight">{{ form.weight }}</td>
            <td class="itemcard-note">{{ form.note }}</td>
            <td class="itemcard-action-wrapper">
              <div class="itemcard-action">
                <button type="button" class="btn btn-lock">
                  <img class="icon-lock-open" src="{% static 'icons/lock-open-icon.svg' %}">
                </button>

                <button type="submit" class="btn btn-main btn-save">Speichern</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </section>
  </div>
</form>
{% endblock %}
