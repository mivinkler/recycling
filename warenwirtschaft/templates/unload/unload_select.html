{# templates/unload/unload_select.html #}
{% extends 'base.html' %}
{% load static %}

{% block title %}Vorsortierung erfassen{% endblock %}

{% block content %}
<div class="itemcard">
  <div class="itemcard-title itemcard-margin-left">
    <h2>Vorsortierung</h2>

    {# Verstecktes Input-Feld für Barcode-Scanner (muss fokussierbar bleiben!) #}
    <input
      type="text"
      id="barcode"
      placeholder="Barcode scannen..."
      autocomplete="off"
      data-accepted="L"
      data-api="{% url 'barcode_unload_api' %}"
      data-create-url="{% url 'unload_create' 0 %}"
      autofocus
      class="visually-hidden-input"
    />

    <label for="barcode" class="barcode-wrapper header-menu-icon svg-icon" id="barcode-label">
      <img src="{% static 'icons/barcode-scan-active.svg' %}" id="barcode-active">
      <img src="{% static 'icons/barcode-scan-inactive.svg' %}" id="barcode-inactive" hidden>
    </label>
  </div>

  <form method="post" id="du-select-form">
    {% csrf_token %}

    <table class="itemcard-table">
      <thead class="itemcard-thead">
        <tr>
          <th class="itemcard-id">№</th>
          <th class="itemcard-id">VID</th>
          <th class="itemcard-material">Material</th>
          <th class="itemcard-boxtype">Behälter</th>
          <th class="itemcard-status">Status</th>
          <th class="itemcard-note">Anmerkung</th>
          <th class="itemcard-action"></th>
        </tr>
      </thead>

      <tbody class="itemcard-tbody">
        {% for delivery_unit in delivery_units %}
        <tr class="itemcard-table-row">
          <td class="itemcard-id"><p>{{ forloop.counter }}</p></td>
          <td class="itemcard-id"><p>{{ delivery_unit.id }}</p></td>
          <td class="itemcard-material"><p>{{ delivery_unit.material }}</p></td>
          <td class="itemcard-boxtype"><p>{{ delivery_unit.get_box_type_display }}</p></td>

          <td class="itemcard-status">
            {% if delivery_unit.status == status_choices.WARTET_AUF_VORSORTIERUNG %}
              <p>Ausstehend</p>
            {% elif delivery_unit.status == status_choices.IN_VORSORTIERUNG %}
              <p>Aktiv</p>
            {% endif %}
          </td>

          <td class="itemcard-note"><p>{{ delivery_unit.note }}</p></td>

          <td class="itemcard-action-wrapper">
            <div class="itemcard-action">
              <button type="submit" name="delivery_unit_id" value="{{ delivery_unit.pk }}" class="btn btn-lock">
                <img class="icon-lock-closed" src="{% static 'icons/lock-icon.svg' %}">
              </button>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </form>
</div>

<script src="{% static 'js/barcode/barcode-unload.js' %}" defer></script>
{% endblock %}
