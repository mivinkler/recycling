{# templates/unload/unload_select.html #}
{% extends 'base.html' %}
{% load static %}

{% block title %}Vorsortierung erfassen{% endblock %}

{% block content %}
<div class="itemcard">
    <div class="itemcard-title itemcard-margin-left">
        <h2>Vorsortierung</h2>

        {# Verstecktes Input-Feld für Barcode-Scanner #}
        <input 
            type="text" 
            id="barcode" 
            placeholder="Barcode scannen..." 
            autocomplete="off" 
            data-accepted="L"
            data-api="{% url 'barcode_unload_api' %}"
            autofocus
            class="visually-hidden-input"
        />

        <label for="barcode" class="barcode-wrapper header-menu-icon svg-icon">
            <img src="{% static 'icons/barcode-scan-active.svg' %}" id="barcode-active">
            <img src="{% static 'icons/barcode-scan-inactive.svg' %}" id="barcode-inactive" hidden>
        </label>
    </div>

    {# ------- Auswahl Liefereinheit ------- #}
    <section class="itemcard-topbox itemcard-margin-left">
        <div class="itemcard-topbox-row">
            <label for="delivery_unit">
                Wareneingang:
            </label>

            <div class="itemcard-topbox-content">
                <select id="delivery_unit">
                    <option value="">--- Liefereinheit auswählen ---</option>
                    {% for du in delivery_units %}
                        <option value="{{ du.id }}">
                            {{ du }} {# nutzt DeliveryUnit.__str__ #}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <aside class="itemcard-action-wrapper">
                <div class="itemcard-topbox-btn"></div>
            </aside>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/barcode/barcode-unload.js' %}"></script>
<script>
  // Automatische Weiterleitung beim Wechsel der Liefereinheit
  document.addEventListener("DOMContentLoaded", function () {
    const sel = document.getElementById("delivery_unit");
    if (!sel) return;

    sel.addEventListener("change", function () {
      const value = sel.value;
      if (!value) return;

      const url = new URL(window.location.href);
      url.searchParams.set("delivery_unit", value);
      window.location.href = url.toString();
    });
  });
</script>
{% endblock %}
