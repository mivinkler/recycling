{% extends 'base.html' %}
{% load static %}

{% block title %}Vorsortierung erfassen{% endblock %}

{% block content %}
<form method="post" action="" id="unload-form">
  {% csrf_token %}

  <div class="itemcard">
    <div class="itemcard-title itemcard-margin-left">
      <h2>Vorsortierung erstellen</h2>
    </div>

    {# ======  Head  ======= #}

    <section class="itemcard-topbox itemcard-margin-left">
      {{ form.delivery_unit.errors }}
      {{ form.non_field_errors }}

      <div class="itemcard-topbox-row">
        <label for="barcode">Barcode:</label>
        <div>
          <input type="text" id="barcode" name="barcode" autofocus autocomplete="off" placeholder="Scannen..." />
        </div>
      </div>

      <div class="itemcard-topbox-row">
        <label for="id_delivery_unit">Liefereinheit:</label>
        <div>{{ form.delivery_unit }}</div>
      </div>
    </section>

    {# ====== Neue Unloads ====== #}

    <section class="itemcard-topbox">
      <div class="itemcard-table-title itemcard-margin-left">Neue Wagen:</div>

      <table class="itemcard-table">
        {{ formset.management_form }}
        
        <thead class="itemcard-thead">
          <tr>       
            <th class="checkbox-circle itemcard-action-left"></th>
            <th class="itemcard-id">№</th>
            <th class="itemcard-material">Material</th>
            <th class="itemcard-boxtype">Behälter</th>
            <th class="itemcard-status">Status</th>
            <th class="itemcard-weight">Gewicht</th>
            <th class="itemcard-action-alone"></th>
          </tr>
        </thead>
        
        <tbody class="itemcard-tbody">
          {{ formset.non_form_errors }}

          {% for f in formset.forms %}
          <tr>
            <td class="checkbox-circle itemcard-action-left">
              <input type="radio" checked>
            </td>
            <td class="itemcard-id">{{ forloop.counter }}</td>
            <td class="itemcard-material">{{ f.material }}</td>
            <td class="itemcard-boxtype">{{ f.box_type }}</td>
            <td class="itemcard-status">{{ f.status }}</td>
            <td class="itemcard-weight">{{ f.weight }}</td>
            <td class="itemcard-action-wrapper"> 
                <div class="btn btn-main">
                  <img src="{% static 'icons/dashboard-icon.svg' %}">
                </div>
                <button type="submit" class="btn btn-main">Speichern</button> 
              </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>

  
    {# ====== Vorhandene Wagen ====== #}

    <section>
      <div class="itemcard-table-title itemcard-margin-left">Vorhandene Wagen:</div>

      <table class="itemcard-table">
        <thead class="itemcard-thead">
          <tr>
            <th class="checkbox-circle itemcard-action-left"></th>
            <th class="itemcard-id">№</th>
            <th class="itemcard-material">Material</th>
            <th class="itemcard-boxtype">Behälter</th>
            <th class="itemcard-status">Status</th>
            <th class="itemcard-weight">Gewicht</th>
            <th class="itemcard-action"></th>
          </tr>
        </thead>

        <tbody class="itemcard-tbody existing-tbody">
          {% for u in existing_unloads %}
            <tr class="itemcard-table-row"
              data-id="{{ u.pk }}"
              data-url-detail-barcode="{% url 'unload_detail_barcode' pk=u.pk %}"
              data-url-update="{% url 'unload_update' pk=u.pk %}">

              <td class="checkbox-circle itemcard-action-left">
                <input type="radio" name="selected_recycling" value="{{ u.pk }}" title="Fraktion verknüpfen">
              </td>

              <td class="itemcard-id">{{ forloop.counter }}</td>
              <td class="itemcard-material"><p>{{ u.material }}</p></td>
              <td class="itemcard-boxtype"><p>{{ u.box_type }}</p></td>
              <td class="itemcard-status"><p>{{ u.status }}</p></td>
              <td class="itemcard-weight"><p>{{ u.weight }}</p></td>

              <td class="itemcard-action-wrapper">
                <div class="btn btn-main">
                  <img src="{% static 'icons/dashboard-icon.svg' %}">
                </div>
                <button type="submit" class="btn btn-main">Speichern</button>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table> 
    </section>
  </div>
</form>


  <style>
    .itemcard-action-wrapper {
      width: 114px;
      background-color: transparent;
      border: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-left: 2px;
    }

    .itemcard-action-wrapper * {
      visibility: hidden;
    }
  
    /* In der Zeile mit aktiviertem Checkbox die Aktionszelle anzeigen */
    .itemcard-tbody tr:has(input[type="radio"]:checked) .itemcard-action-wrapper * {
      visibility: visible;
    }
  </style>


{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/barcode-scan.js' %}"></script>
{% endblock %}

